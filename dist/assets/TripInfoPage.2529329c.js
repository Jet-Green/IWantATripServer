import{_ as K,q as O,u as G,p as J,h as Q,r as T,i as W,O as X,s as Y,b as p,o as f,c as h,d as o,w as l,e as s,x as Z,B as ee,g as e,t as m,f as D,k as L,F as B,v as S,l as c,y as k,K as te,L as se}from"./index.1fefcd0b.js";const x=b=>(te("data-v-79d3e2d5"),b=b(),se(),b),oe={style:{"overflow-x":"hidden"}},le={class:"ma-0"},ne=["src"],ae=["src"],ue=x(()=>e("div",{class:"custom-slick-arrow",style:{left:"10px","z-index":"1"}},[e("span",{class:"mdi mdi-48px mdi-chevron-left"})],-1)),ie=x(()=>e("div",{class:"custom-slick-arrow",style:{right:"10px"}},[e("span",{class:"mdi mdi-48px mdi-chevron-right"})],-1)),re=c(" \u041F\u0440\u043E\u0434\u043E\u043B\u0436\u0438\u0442\u0435\u043B\u044C\u043D\u043E\u0441\u0442\u044C: "),ce=c(" \u0411\u043B\u0438\u0436\u0430\u0439\u0448\u0438\u0439 \u0432\u044B\u0435\u0437\u0434: "),de=x(()=>e("div",null,"\u041A\u043E\u043B\u0438\u0447\u0435\u0441\u0442\u0432\u043E \u0447\u0435\u043B\u043E\u0432\u0435\u043A:",-1)),_e={style:{width:"50%"}},pe=c(" \u0426\u0435\u043D\u0430 "),fe={class:"d-flex justify-center ma-8"},me=c(" \u041A\u0443\u043F\u0438\u0442\u044C "),ve=["innerHTML"],he=c(" \u0424a\u043C\u0438\u043B\u0438\u044F \u0418\u043C\u044F "),ge=c(" \u0422\u0435\u043B\u0435\u0444\u043E\u043D "),ye=x(()=>e("div",null,"\u0426\u0435\u043D\u0430",-1)),xe={class:"d-flex direction-column"},be=x(()=>e("span",{style:{"font-size":"8px"}},"\u043A\u043E\u043B-\u0432\u043E",-1)),ke=x(()=>e("div",null,"\u041E\u043F\u043B\u0430\u0442\u0438\u0442\u044C",-1)),we={class:"d-flex space-around"},Ie=c(" \u0441\u0435\u0439\u0447\u0430\u0441 "),Te=c(" \u043F\u043E\u0442\u043E\u043C "),Be={__name:"TripInfoPage",setup(b){const P=O(),N=G().query._id,R=J(),i=Q(),j="/trips";let g=T([]),a=T({}),d=W({fullname:"",phone:""});R.getById(N).then(u=>{a.value=u.data;for(let t of u.data.cost)g.value.push({cost:t.price,count:0,costType:t.first})}).catch(u=>{console.log(u)});function z(u){return new Date(Number(u)).toLocaleDateString()}function F(u){return a.value.images[u]}let V=X(()=>{let u=0;if(g.value.length)for(let t of g.value)u+=t.cost*t.count;return u}),y=T(!1),A=()=>{i.user?y.value=!0:P.push("/reg")};async function C(u){if(d.phone){let t={isBoughtNow:u,cart:[...g.value],userId:i.user._id};for(let r=0;r<t.cart.length;r++)t.cart[r].count==0&&t.cart.splice(r,1);await i.buyTrip(a.value._id,t).then(()=>{k.config({duration:3,top:"90vh"}),k.success({content:"\u0422\u0443\u0440 \u0437\u0430\u043A\u0430\u0437\u0430\u043D!"}),y.value=!1}).catch(r=>{console.log(r)}),i.user.fullinfo.fullname=d.fullname,i.user.fullinfo.phone=d.phone,await i.updateUser({email:i.user.email,fullinfo:i.user.fullinfo}).then(r=>{i.user=r.data}).catch(r=>{console.log(r)})}else k.config({duration:3,top:"90vh"}),k.success({content:"\u041D\u0443\u0436\u0435\u043D \u0442\u0435\u043B\u0435\u0444\u043E\u043D"})}return Y(()=>{i.user&&(d.fullname=i.user.fullinfo.fullname,d.phone=i.user.fullinfo.phone)}),(u,t)=>{const r=p("a-spin"),M=p("a-carousel"),_=p("a-col"),$=p("a-progress"),w=p("a-button"),I=p("a-row"),U=p("a-input"),q=p("a-input-number"),H=p("a-modal");return f(),h("div",oe,[o(ee,{backRoute:j}),o(I,{class:"justify-center d-flex"},{default:l(()=>[o(_,{xs:22,xl:16},{default:l(()=>[e("h2",le,m(s(a).name),1),s(a)._id?L("",!0):(f(),D(r,{key:0,size:"large"})),s(a)._id?(f(),D(I,{key:1,gutter:[12,12],class:"text justify-center d-flex"},{default:l(()=>[o(_,{xs:24,md:12},{default:l(()=>[o(M,{arrows:"","dots-class":"slick-dots slick-thumb"},{customPaging:l(n=>[e("a",null,[e("img",{src:F(n.i)},null,8,ne)])]),prevArrow:l(()=>[ue]),nextArrow:l(()=>[ie]),default:l(()=>[(f(!0),h(B,null,S(s(a).images,(n,v)=>(f(),h("div",{key:v},[e("img",{src:n,alt:"",srcset:""},null,8,ae)]))),128))]),_:1})]),_:1}),o(_,{xs:24,md:12,class:"pa-8"},{default:l(()=>[e("p",null,m(s(a).offer),1),e("div",null,[re,e("b",null,m(s(a).duration)+" \u0434\u043D.",1)]),e("div",null,[ce,e("b",null,m(z(s(a).start)),1)]),de,e("div",_e,[o($,{percent:s(a).billsList.length/s(a).maxPeople*100,format:()=>`${s(a).maxPeople} \u0447\u0435\u043B`},null,8,["percent","format"])]),e("div",null,[pe,(f(!0),h(B,null,S(s(a).cost,(n,v)=>(f(),h("div",{key:v,class:"cost"},[c(m(n.first)+" : ",1),e("b",null,m(n.price)+" \u0440\u0443\u0431.",1)]))),128))]),e("div",fe,[o(w,{type:"primary",class:"lets_go_btn",size:"large",style:{display:"flex","justify-content":"center"},onClick:t[0]||(t[0]=n=>s(A)())},{default:l(()=>[me]),_:1})])]),_:1}),o(_,{xs:24},{default:l(()=>[e("span",{innerHTML:s(a).description},null,8,ve)]),_:1})]),_:1})):L("",!0)]),_:1})]),_:1}),o(H,{visible:s(y),"onUpdate:visible":t[5]||(t[5]=n=>Z(y)?y.value=n:y=n),footer:null},{default:l(()=>[o(I,{gutter:[4,4]},{default:l(()=>[o(_,{span:24,md:12},{default:l(()=>[he,o(U,{style:{width:"100%"},value:s(d).fullname,"onUpdate:value":t[1]||(t[1]=n=>s(d).fullname=n),placeholder:"\u0418\u0432\u0430\u043D\u043E\u0432 \u0418\u0432\u0430\u043D \u0418\u0432\u0430\u043D\u043E\u0432\u0438\u0447"},null,8,["value"])]),_:1}),o(_,{span:24,md:12},{default:l(()=>[ge,o(U,{style:{width:"100%"},value:s(d).phone,"onUpdate:value":t[2]||(t[2]=n=>s(d).phone=n),placeholder:"79127528874"},null,8,["value"])]),_:1}),o(_,{span:24},{default:l(()=>[ye,(f(!0),h(B,null,S(s(a).cost,(n,v)=>(f(),h("div",{class:"d-flex space-around align-center",key:v},[c(m(n.first),1),e("span",null,m(n.price)+" \u0440\u0443\u0431. ",1),e("div",xe,[be,o(q,{value:s(g)[v].count,"onUpdate:value":E=>s(g)[v].count=E,min:0,placeholder:"\u0447\u0435\u043B"},null,8,["value","onUpdate:value"])])]))),128))]),_:1}),o(_,{span:24},{default:l(()=>[e("b",null,"\u0418\u0442\u043E\u0433\u043E: "+m(s(V))+" \u0440\u0443\u0431.",1)]),_:1}),o(_,{span:24},{default:l(()=>[ke,e("div",we,[o(w,{type:"primary",onClick:t[3]||(t[3]=n=>C(!0))},{default:l(()=>[Ie]),_:1}),o(w,{onClick:t[4]||(t[4]=n=>C(!1))},{default:l(()=>[Te]),_:1})])]),_:1})]),_:1})]),_:1},8,["visible"])])}}},Ue=K(Be,[["__scopeId","data-v-79d3e2d5"]]);export{Ue as default};
