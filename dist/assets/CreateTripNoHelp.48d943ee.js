import{p as Z,h as ee,r as m,q as te,i as le,m as I,s as oe,b as f,o as C,c as N,d as l,w as s,B as ae,g as c,e as n,f as se,k as ne,F as j,v as z,x as q,t as ie,j as ue,l as u,T as Y,y as D,z as re}from"./index.87941c2a.js";import{_ as de}from"./ImageCropper.a83bea9b.js";import{_ as pe}from"./UserFullInfo.937fe014.js";import{Q as ce}from"./vue-quill.snow.1b0fa03e.js";import{t as me,l as fe}from"./ru_RU.32190336.js";const _e=["onSubmit"],ve=c("h2",null,"\u0421\u043E\u0437\u0434\u0430\u0442\u044C \u0442\u0443\u0440",-1),he=u(" \u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 "),ge=u(" \u0424\u043E\u0442\u043E\u0433\u0440\u0430\u0444\u0438\u0438 "),ye={class:"d-flex",style:{"overflow-x":"scroll"}},xe=["src","onClick"],be=c("span",{class:"mdi mdi-12px mdi-plus"},null,-1),ke=u(" \u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0444\u043E\u0442\u043E "),Ue=u(" \u0414\u0430\u0442\u0430 \u043D\u0430\u0447\u0430\u043B\u0430 "),Te=u(" \u0414\u0430\u0442\u0430 \u043A\u043E\u043D\u0446\u0430 "),Se=u(" \u041F\u0440\u043E\u0434\u043E\u043B\u0436\u0438\u0442\u0435\u043B\u044C\u043D\u043E\u0441\u0442\u044C "),we={style:{"line-height":"40px"}},Ce=u(" \u041C\u0430\u043A\u0441. \u0447\u0438\u0441\u043B\u043E \u043B\u044E\u0434\u0435\u0439 "),Me=u(" \u0426\u0435\u043D\u044B "),Ne=c("span",{class:"mdi mdi-minus",style:{cursor:"pointer"}},null,-1),Oe=c("span",{class:"mdi mdi-12px mdi-plus"},null,-1),De=u(" \u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0446\u0435\u043D\u044B "),Re=u("\u0422\u0438\u043F \u0442\u0443\u0440\u0430 "),Be=u("\u041C\u0438\u043D. \u0432\u043E\u0437\u0440\u0430\u0441\u0442, \u043B\u0435\u0442 "),Le=u("\u041D\u0430\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u0438\u0435 "),Pe=u("\u041F\u0435\u0440\u0438\u043E\u0434 "),Ie=u(" \u0420\u0435\u043A\u043B\u0430\u043C\u0430 "),Ae=u(" \u041C\u0430\u0440\u0448\u0440\u0443\u0442 "),Fe=u(" \u041E\u043F\u0438\u0441\u0430\u043D\u0438\u0435 \u043F\u0440\u043E\u0433\u0440\u0430\u043C\u043C\u044B "),Je=u("\u041E\u0442\u043F\u0440\u0430\u0432\u0438\u0442\u044C "),$e=c("h3",null,"\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u0444\u043E\u0442\u043E?",-1),je={class:"d-flex justify-center"},ze=u("\u0414\u0430 "),Ke={__name:"CreateTripNoHelp",setup(qe){const H=Z(),_=ee(),A=["DD.MM.YY","DD.MM.YY"],E=["MM.YY"],R=fe,b=m(null);let F="";m(null);const v=m(null),k=m(null),U=m(null),O=m(!1),B=m(null),L=te();let h=m(!1),M=m([]),T=[],t=le({name:"",start:null,end:null,maxPeople:null,duration:"",images:[],tripRoute:"",distance:"",cost:[],offer:"",description:v.value,location:"",tripType:"",fromAge:"",period:""}),P=null;const Q=a=>{let e=t.cost.indexOf(a);e!==-1&&t.cost.splice(e,1)},V=()=>{t.cost.push({type:"",price:""})},G=()=>{M.value.splice(B.value,1),T.splice(B.value,1),O.value=!1};function K(){v.value=v.value.split("<p><br></p>").join(""),t.description=v.value;let a={};for(let r in t)a[r]=t[r];let e=a.period.month().toString(),i=e.length==1?"0"+e:e;a.period=i+"."+a.period.year().toString().slice(2),Y.createTrip(t,_.user.email).then(async r=>{const d=r.data._id;let S=new FormData;for(let g=0;g<T.length;g++)S.append("trip-image",new File([T[g]],d+"_"+g+".png"),d+"_"+g+".png");function w(){L.push("/trips")}Y.uploadTripImages(S).then(g=>{Object.assign(t,{name:"",start:null,end:null,maxPeople:null,duration:"",images:[],tripRoute:"",distance:"",cost:[],offer:"",description:v.value,location:"",tripType:"",fromAge:"",period:""}),P?_.updateUser({email:_.user.email,fullinfo:P,$push:{trips:d}}).then(p=>{_.user=p.data,T=[],M.value=[],b.value.setHTML(""),D.config({duration:3,top:"90vh"}),D.success({content:"\u0422\u0443\u0440 \u0441\u043E\u0437\u0434\u0430\u043D!",onClose:w})}).catch(p=>{console.log(p)}):_.updateUser({email:_.user.email,$push:{trips:d}}).then(p=>{_.user=p.data,T=[],M.value=[],b.value.setHTML(""),D.config({duration:3,top:"90vh"}),D.success({content:"\u0422\u0443\u0440 \u0441\u043E\u0437\u0434\u0430\u043D!",onClose:w})}).catch(p=>{console.log(p)})})})}function W(a){h.value=!1,T.push(a),M.value.push(URL.createObjectURL(a))}function X(a){P=a}return I(v,a=>{F=a,F!==a&&(b.value.setHTML(a),re(()=>{let e=b.value.getQuill();e.setSelection(a.length,0,"api"),e.focus()}))}),I(k,()=>{let a=Number(JSON.parse(JSON.stringify(U.value)))-Number(JSON.parse(JSON.stringify(k.value)));a>=0?t.duration=Math.round(a/864e5):t.duration="",t.start=Date.parse(k.value.$d.toString())}),I(U,()=>{let a=Date.parse(JSON.parse(JSON.stringify(U.value)))-Date.parse(JSON.parse(JSON.stringify(k.value)));t.duration=Math.round(a/864e5),a>=0?t.duration=Math.round(a/864e5):t.duration="",t.end=Date.parse(U.value.$d.toString())}),oe(()=>{L.currentRoute.value.query._id&&H.getById(L.currentRoute.value.query._id).then(a=>{let e=a.data;delete e.__v,t.name=e.name,t.start=e.start,t.end=e.end,t.maxPeople=e.maxPeople,t.duration=e.duration,t.tripType=e.tripType,t.distance=e.distance,t.cost=e.cost,b.value.setHTML(e.description),t.location=e.location,t.fromAge=e.fromAge,t.period=e.period;let i=document.getElementById("ad"),r=document.getElementById("route");i.value=e.tripRoute,r.value=e.offer})}),(a,e)=>{const i=f("a-col"),r=f("a-input"),d=f("a-button"),S=f("a-date-picker"),w=f("a-input-number"),g=f("a-select"),p=f("a-textarea"),J=f("a-row"),$=f("a-modal");return C(),N("div",null,[l(ae),l(J,{type:"flex",justify:"center"},{default:s(()=>[l(i,{xs:22,lg:12},{default:s(()=>[c("form",{action:"POST",onSubmit:ue(K,["prevent"])},[l(J,{gutter:[16,16]},{default:s(()=>{var y;return[(y=n(_).user)!=null&&y.fullinfo?ne("",!0):(C(),se(i,{key:0,span:24},{default:s(()=>[l(pe,{onFullInfo:X})]),_:1})),l(i,{span:24},{default:s(()=>[ve,he,l(r,{placeholder:"\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u0442\u0443\u0440\u0430",size:"large",value:n(t).name,"onUpdate:value":e[0]||(e[0]=o=>n(t).name=o)},null,8,["value"])]),_:1}),l(i,{xs:24},{default:s(()=>[ge,c("div",ye,[(C(!0),N(j,null,z(n(M),(o,x)=>(C(),N("img",{key:x,src:o,alt:"",class:"ma-4",style:{"max-width":"200px"},onClick:Ye=>{O.value=!0,B.value=x}},null,8,xe))),128))]),l(d,{type:"dashed",block:"",onClick:e[1]||(e[1]=o=>q(h)?h.value=!0:h=!0),class:"ma-8"},{default:s(()=>[be,ke]),_:1})]),_:1}),l(i,{span:12},{default:s(()=>[Ue,l(S,{value:k.value,"onUpdate:value":e[2]||(e[2]=o=>k.value=o),style:{width:"100%"},placeholder:"\u041D\u0430\u0447\u0430\u043B\u043E",locale:n(R),format:A},null,8,["value","locale"])]),_:1}),l(i,{span:12},{default:s(()=>[Te,l(S,{value:U.value,"onUpdate:value":e[3]||(e[3]=o=>U.value=o),style:{width:"100%"},placeholder:"\u041A\u043E\u043D\u0435\u0446",locale:n(R),format:A},null,8,["value","locale"])]),_:1}),l(i,{span:12},{default:s(()=>[Se,c("p",we,ie(n(t).duration)+" \u0434\u043D.",1)]),_:1}),l(i,{span:12},{default:s(()=>[Ce,l(w,{value:n(t).maxPeople,"onUpdate:value":e[4]||(e[4]=o=>n(t).maxPeople=o),style:{width:"100%"},placeholder:"11",min:1},null,8,["value"])]),_:1}),l(i,{span:24},{default:s(()=>[Me,(C(!0),N(j,null,z(n(t).cost,o=>(C(),N("div",{key:o.type,style:{display:"flex"},align:"baseline",class:"mb-16"},[l(r,{value:o.first,"onUpdate:value":x=>o.first=x,placeholder:"\u0414\u043B\u044F \u043A\u043E\u0433\u043E"},null,8,["value","onUpdate:value"]),l(w,{value:o.price,"onUpdate:value":x=>o.price=x,style:{width:"100%"},placeholder:"\u0426\u0435\u043D\u0430",min:0,step:.01,class:"ml-16 mr-16"},null,8,["value","onUpdate:value","step"]),l(d,{onClick:x=>Q(o),shape:"circle"},{default:s(()=>[Ne]),_:2},1032,["onClick"])]))),128)),l(d,{type:"dashed",block:"",onClick:V,class:"ma-8"},{default:s(()=>[Oe,De]),_:1})]),_:1}),l(i,{xs:24,md:12},{default:s(()=>[Re,c("div",null,[l(g,{value:n(t).tripType,"onUpdate:value":e[5]||(e[5]=o=>n(t).tripType=o),style:{width:"100%"},options:n(me)},null,8,["value","options"])])]),_:1}),l(i,{xs:24,md:12},{default:s(()=>[Be,l(w,{value:n(t).fromAge,"onUpdate:value":e[6]||(e[6]=o=>n(t).fromAge=o),style:{width:"100%"},placeholder:"10",min:0,max:100},null,8,["value"])]),_:1}),l(i,{xs:24,md:12},{default:s(()=>[Le,l(r,{placeholder:"\u0411\u0430\u0439\u043A\u0430\u043B",size:"large",value:n(t).location,"onUpdate:value":e[7]||(e[7]=o=>n(t).location=o)},null,8,["value"])]),_:1}),l(i,{xs:24,md:12},{default:s(()=>[Pe,l(S,{value:n(t).period,"onUpdate:value":e[8]||(e[8]=o=>n(t).period=o),style:{width:"100%",height:"40px"},picker:"month",locale:n(R),format:E},null,8,["value","locale"])]),_:1}),l(i,{span:24},{default:s(()=>[Ie,l(p,{placeholder:"\u0437\u0430\u0432\u043B\u0435\u043A\u0430\u0442\u0435\u043B\u044C\u043D\u043E\u0435 \u043E\u043F\u0438\u0441\u0430\u043D\u0438\u0435",size:"large",value:n(t).offer,"onUpdate:value":e[9]||(e[9]=o=>n(t).offer=o),id:"ad"},null,8,["value"])]),_:1}),l(i,{span:24},{default:s(()=>[Ae,l(p,{placeholder:"\u0413\u043B\u0430\u0437\u043E\u0432-\u041F\u0435\u0440\u043C\u044C 300\u043A\u043C",size:"large",value:n(t).tripRoute,"onUpdate:value":e[10]||(e[10]=o=>n(t).tripRoute=o),id:"route"},null,8,["value"])]),_:1}),l(i,{span:24,style:{display:"flex","flex-direction":"column"}},{default:s(()=>[Fe,l(n(ce),{theme:"snow",ref_key:"quill",ref:b,content:v.value,"onUpdate:content":e[11]||(e[11]=o=>v.value=o),contentType:"html",toolbar:[["bold","italic","underline"],[{list:"ordered"},{list:"bullet"}],[{color:["#000000","#ff6600","#3daff5"]}],[{align:[]}]]},null,8,["content"])]),_:1}),l(i,{span:24,class:"d-flex justify-center"},{default:s(()=>[l(d,{class:"lets_go_btn mt-8",type:"primary",size:"large","html-type":"submit"},{default:s(()=>[Je]),_:1})]),_:1})]}),_:1})],40,_e),l($,{visible:n(h),"onUpdate:visible":e[12]||(e[12]=y=>q(h)?h.value=y:h=y),footer:null},{default:s(()=>[l(de,{onAddImage:W})]),_:1},8,["visible"]),l($,{visible:O.value,"onUpdate:visible":e[13]||(e[13]=y=>O.value=y),footer:null},{default:s(()=>[$e,c("div",je,[l(d,{class:"mt-16",type:"primary",size:"large",onClick:G},{default:s(()=>[ze]),_:1})])]),_:1},8,["visible"])]),_:1})]),_:1})])}}};export{Ke as default};
