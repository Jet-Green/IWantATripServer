import{_ as G,m as J,u as K,Q as O,k as W,C as P,r as D,n as X,p as ee,b as f,o as i,c as m,d as a,w as n,e as t,H as te,g as se,h as s,t as c,f as L,q as w,F as S,v as U,x as d,y as T,Y as oe,Z as le}from"./index.3be2e089.js";const x=b=>(oe("data-v-d7b3d4ea"),b=b(),le(),b),ae={style:{"overflow-x":"hidden"}},ne={class:"ma-0"},re=["src"],ue=["src"],ie=x(()=>s("div",{class:"custom-slick-arrow",style:{left:"10px","z-index":"1"}},[s("span",{class:"mdi mdi-48px mdi-chevron-left"})],-1)),ce=x(()=>s("div",{class:"custom-slick-arrow",style:{right:"10px"}},[s("span",{class:"mdi mdi-48px mdi-chevron-right"})],-1)),de=d(" \u041F\u0440\u043E\u0434\u043E\u043B\u0436\u0438\u0442\u0435\u043B\u044C\u043D\u043E\u0441\u0442\u044C: "),_e=d(" \u0411\u043B\u0438\u0436\u0430\u0439\u0448\u0438\u0439 \u0432\u044B\u0435\u0437\u0434: "),pe=x(()=>s("div",null,"\u041A\u043E\u043B\u0438\u0447\u0435\u0441\u0442\u0432\u043E \u0447\u0435\u043B\u043E\u0432\u0435\u043A:",-1)),fe={style:{width:"50%"}},me=d(" \u0426\u0435\u043D\u0430 "),ve={class:"d-flex justify-center ma-8"},he=d(" \u041A\u0443\u043F\u0438\u0442\u044C "),ge={key:0},ye=["innerHTML"],xe=d(" \u0424a\u043C\u0438\u043B\u0438\u044F \u0418\u043C\u044F "),be=d(" \u0422\u0435\u043B\u0435\u0444\u043E\u043D "),ke=x(()=>s("div",null,"\u0426\u0435\u043D\u0430",-1)),we={class:"d-flex direction-column"},Te=x(()=>s("span",{style:{"font-size":"8px"}},"\u043A\u043E\u043B-\u0432\u043E",-1)),Ie=x(()=>s("div",null,"\u041E\u043F\u043B\u0430\u0442\u0438\u0442\u044C",-1)),Ce={class:"d-flex space-around"},Pe=d(" \u0441\u0435\u0439\u0447\u0430\u0441 "),De=d(" \u043F\u043E\u0442\u043E\u043C "),Le={__name:"TripInfoPage",setup(b){const z=J(),B=K().query._id,R=O(),_=W(),N="/trips",V=P(()=>o.value.creatorForm[1]=="author"?"\u0430\u0432\u0442\u043E\u0440 \u0442\u0443\u0440\u0430":o.value.creatorForm[1]=="operator"?"\u0442\u0443\u0440\u043E\u043F\u0435\u0440\u0430\u0442\u043E\u0440":"\u0442\u0443\u0440\u0430\u0433\u0435\u043D\u0441\u0442\u0432\u043E");let v=D([]),o=D({}),h=X({fullname:"",phone:""}),k=P(()=>{let u=0;for(let e=0;e<o.value.billsList.length;e++)for(let l=0;l<o.value.billsList[e].cart.length;l++)u+=o.value.billsList[e].cart[l].count;return u});const $=u=>{let e=new Date(u).toLocaleDateString("ru-Ru",{year:"2-digit",month:"2-digit",day:"2-digit"});return e!=="Invalid Date"&&e?e:""};function A(u){return o.value.images[u]}let H=P(()=>{let u=0;if(v.value.length)for(let e of v.value)u+=e.cost*e.count;return u}),y=D(!1),M=()=>{_.user?y.value=!0:z.push("/reg")};async function j(u){if(h.phone){let e={isBoughtNow:u,cart:[...v.value],userId:_.user._id};for(let l=0;l<e.cart.length;l++)e.cart[l].count==0&&e.cart.splice(l,1);await _.buyTrip(o.value._id,e).then(()=>{T.config({duration:3,top:"90vh"}),T.success({content:"\u0422\u0443\u0440 \u0437\u0430\u043A\u0430\u0437\u0430\u043D!"}),y.value=!1}).catch(l=>{console.log(l)}),_.user.fullinfo.fullname=h.fullname,_.user.fullinfo.phone=h.phone,await _.updateUser({email:_.user.email,fullinfo:_.user.fullinfo}).then(l=>{_.user=l.data}).catch(l=>{console.log(l)})}else T.config({duration:3,top:"90vh"}),T.success({content:"\u041D\u0443\u0436\u0435\u043D \u0442\u0435\u043B\u0435\u0444\u043E\u043D"})}return ee(()=>{let u=!1;for(let e of R.trips)if(e._id==B){o.value=e;for(let l of e.cost)v.value.push({cost:l.price,count:0,costType:l.first});u=!0}u||R.getById(B).then(e=>{o.value=e.data;for(let l of e.data.cost)v.value.push({cost:l.price,count:0,costType:l.first})}).catch(e=>{console.log(e)})}),(u,e)=>{const l=f("a-spin"),q=f("a-carousel"),p=f("a-col"),E=f("a-progress"),I=f("a-button"),C=f("a-row"),F=f("a-input"),Q=f("a-input-number"),Y=f("a-modal");return i(),m("div",ae,[a(se,{backRoute:N}),a(C,{class:"justify-center d-flex"},{default:n(()=>[a(p,{xs:22,xl:16},{default:n(()=>[s("h2",ne,c(t(o).name),1),t(o)._id?w("",!0):(i(),L(l,{key:0,size:"large"})),t(o)._id?(i(),L(C,{key:1,gutter:[12,12],class:"text justify-center d-flex"},{default:n(()=>[a(p,{xs:24,md:12},{default:n(()=>[a(q,{arrows:"","dots-class":"slick-dots slick-thumb"},{customPaging:n(r=>[s("a",null,[s("img",{src:A(r.i)},null,8,re)])]),prevArrow:n(()=>[ie]),nextArrow:n(()=>[ce]),default:n(()=>[(i(!0),m(S,null,U(t(o).images,(r,g)=>(i(),m("div",{key:g},[s("img",{src:r,alt:"",srcset:""},null,8,ue)]))),128))]),_:1})]),_:1}),a(p,{xs:24,md:12,class:"pa-8"},{default:n(()=>[s("p",null,"\u0410\u0432\u0442\u043E\u0440 \u0442\u0443\u0440\u0430: "+c(t(o).creatorForm[0])+" ("+c(t(V))+")",1),s("p",null,c(t(o).offer),1),s("div",null,[de,s("b",null,c(t(o).duration)+" \u0434\u043D.",1)]),s("div",null,[_e,s("b",null,c($(t(o).start)),1)]),pe,s("div",fe,[a(E,{percent:t(k)/t(o).maxPeople*100,format:()=>`${t(o).maxPeople} \u0447\u0435\u043B`},null,8,["percent","format"])]),s("div",null,[me,(i(!0),m(S,null,U(t(o).cost,(r,g)=>(i(),m("div",{key:g,class:"cost"},[d(c(r.first)+" : ",1),s("b",null,c(r.price)+" \u0440\u0443\u0431.",1)]))),128))]),s("div",ve,[t(k)!=t(o).maxPeople?(i(),L(I,{key:0,type:"primary",class:"lets_go_btn",size:"large",style:{display:"flex","justify-content":"center"},onClick:e[0]||(e[0]=r=>t(M)())},{default:n(()=>[he]),_:1})):w("",!0)]),s("div",null,[t(k)==t(o).maxPeople?(i(),m("b",ge," \u043C\u0435\u0441\u0442 \u0431\u043E\u043B\u044C\u0448\u0435 \u043D\u0435\u0442 ")):w("",!0)])]),_:1}),a(p,{xs:24},{default:n(()=>[s("span",{innerHTML:t(o).description},null,8,ye)]),_:1})]),_:1})):w("",!0)]),_:1})]),_:1}),a(Y,{visible:t(y),"onUpdate:visible":e[5]||(e[5]=r=>te(y)?y.value=r:y=r),footer:null},{default:n(()=>[a(C,{gutter:[4,4]},{default:n(()=>[a(p,{span:24,md:12},{default:n(()=>[xe,a(F,{style:{width:"100%"},value:t(h).fullname,"onUpdate:value":e[1]||(e[1]=r=>t(h).fullname=r),placeholder:"\u0418\u0432\u0430\u043D\u043E\u0432 \u0418\u0432\u0430\u043D \u0418\u0432\u0430\u043D\u043E\u0432\u0438\u0447"},null,8,["value"])]),_:1}),a(p,{span:24,md:12},{default:n(()=>[be,a(F,{style:{width:"100%"},value:t(h).phone,"onUpdate:value":e[2]||(e[2]=r=>t(h).phone=r),placeholder:"79127528874"},null,8,["value"])]),_:1}),a(p,{span:24},{default:n(()=>[ke,(i(!0),m(S,null,U(t(o).cost,(r,g)=>(i(),m("div",{class:"d-flex space-around align-center",key:g},[d(c(r.first),1),s("span",null,c(r.price)+" \u0440\u0443\u0431. ",1),s("div",we,[Te,a(Q,{value:t(v)[g].count,"onUpdate:value":Z=>t(v)[g].count=Z,min:0,max:t(o).maxPeople-t(k),placeholder:"\u0447\u0435\u043B"},null,8,["value","onUpdate:value","max"])])]))),128))]),_:1}),a(p,{span:24},{default:n(()=>[s("b",null,"\u0418\u0442\u043E\u0433\u043E: "+c(t(H))+" \u0440\u0443\u0431.",1)]),_:1}),a(p,{span:24},{default:n(()=>[Ie,s("div",Ce,[a(I,{type:"primary",onClick:e[3]||(e[3]=r=>j(!0))},{default:n(()=>[Pe]),_:1}),a(I,{onClick:e[4]||(e[4]=r=>j(!1))},{default:n(()=>[De]),_:1})])]),_:1})]),_:1})]),_:1},8,["visible"])])}}},Be=G(Le,[["__scopeId","data-v-d7b3d4ea"]]);export{Be as default};
